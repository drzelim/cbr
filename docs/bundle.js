(()=>{var t={484:function(t){t.exports=function(){"use strict";var t=6e4,e=36e5,s="millisecond",n="second",r="minute",i="hour",a="day",o="week",u="month",h="quarter",l="year",c="date",d="Invalid Date",_=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},v=function(t,e,s){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(s)+t},m={s:v,z:function(t){var e=-t.utcOffset(),s=Math.abs(e),n=Math.floor(s/60),r=s%60;return(e<=0?"+":"-")+v(n,2,"0")+":"+v(r,2,"0")},m:function t(e,s){if(e.date()<s.date())return-t(s,e);var n=12*(s.year()-e.year())+(s.month()-e.month()),r=e.clone().add(n,u),i=s-r<0,a=e.clone().add(n+(i?-1:1),u);return+(-(n+(s-r)/(i?r-a:a-r))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:u,y:l,w:o,d:a,D:c,h:i,m:r,s:n,ms:s,Q:h}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},$="en",y={};y[$]=f;var g=function(t){return t instanceof D},w=function t(e,s,n){var r;if(!e)return $;if("string"==typeof e){var i=e.toLowerCase();y[i]&&(r=i),s&&(y[i]=s,r=i);var a=e.split("-");if(!r&&a.length>1)return t(a[0])}else{var o=e.name;y[o]=e,r=o}return!n&&r&&($=r),r||!n&&$},b=function(t,e){if(g(t))return t.clone();var s="object"==typeof e?e:{};return s.date=t,s.args=arguments,new D(s)},M=m;M.l=w,M.i=g,M.w=function(t,e){return b(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var D=function(){function f(t){this.$L=w(t.locale,null,!0),this.parse(t)}var v=f.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,s=t.utc;if(null===e)return new Date(NaN);if(M.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(_);if(n){var r=n[2]-1||0,i=(n[7]||"0").substring(0,3);return s?new Date(Date.UTC(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)):new Date(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return M},v.isValid=function(){return!(this.$d.toString()===d)},v.isSame=function(t,e){var s=b(t);return this.startOf(e)<=s&&s<=this.endOf(e)},v.isAfter=function(t,e){return b(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<b(t)},v.$g=function(t,e,s){return M.u(t)?this[e]:this.set(s,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var s=this,h=!!M.u(e)||e,d=M.p(t),_=function(t,e){var n=M.w(s.$u?Date.UTC(s.$y,e,t):new Date(s.$y,e,t),s);return h?n:n.endOf(a)},p=function(t,e){return M.w(s.toDate()[t].apply(s.toDate("s"),(h?[0,0,0,0]:[23,59,59,999]).slice(e)),s)},f=this.$W,v=this.$M,m=this.$D,$="set"+(this.$u?"UTC":"");switch(d){case l:return h?_(1,0):_(31,11);case u:return h?_(1,v):_(0,v+1);case o:var y=this.$locale().weekStart||0,g=(f<y?f+7:f)-y;return _(h?m-g:m+(6-g),v);case a:case c:return p($+"Hours",0);case i:return p($+"Minutes",1);case r:return p($+"Seconds",2);case n:return p($+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var o,h=M.p(t),d="set"+(this.$u?"UTC":""),_=(o={},o[a]=d+"Date",o[c]=d+"Date",o[u]=d+"Month",o[l]=d+"FullYear",o[i]=d+"Hours",o[r]=d+"Minutes",o[n]=d+"Seconds",o[s]=d+"Milliseconds",o)[h],p=h===a?this.$D+(e-this.$W):e;if(h===u||h===l){var f=this.clone().set(c,1);f.$d[_](p),f.init(),this.$d=f.set(c,Math.min(this.$D,f.daysInMonth())).$d}else _&&this.$d[_](p);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[M.p(t)]()},v.add=function(s,h){var c,d=this;s=Number(s);var _=M.p(h),p=function(t){var e=b(d);return M.w(e.date(e.date()+Math.round(t*s)),d)};if(_===u)return this.set(u,this.$M+s);if(_===l)return this.set(l,this.$y+s);if(_===a)return p(1);if(_===o)return p(7);var f=(c={},c[r]=t,c[i]=e,c[n]=1e3,c)[_]||1,v=this.$d.getTime()+s*f;return M.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,s=this.$locale();if(!this.isValid())return s.invalidDate||d;var n=t||"YYYY-MM-DDTHH:mm:ssZ",r=M.z(this),i=this.$H,a=this.$m,o=this.$M,u=s.weekdays,h=s.months,l=function(t,s,r,i){return t&&(t[s]||t(e,n))||r[s].substr(0,i)},c=function(t){return M.s(i%12||12,t,"0")},_=s.meridiem||function(t,e,s){var n=t<12?"AM":"PM";return s?n.toLowerCase():n},f={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:M.s(o+1,2,"0"),MMM:l(s.monthsShort,o,h,3),MMMM:l(h,o),D:this.$D,DD:M.s(this.$D,2,"0"),d:String(this.$W),dd:l(s.weekdaysMin,this.$W,u,2),ddd:l(s.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(i),HH:M.s(i,2,"0"),h:c(1),hh:c(2),a:_(i,a,!0),A:_(i,a,!1),m:String(a),mm:M.s(a,2,"0"),s:String(this.$s),ss:M.s(this.$s,2,"0"),SSS:M.s(this.$ms,3,"0"),Z:r};return n.replace(p,(function(t,e){return e||f[t]||r.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(s,c,d){var _,p=M.p(c),f=b(s),v=(f.utcOffset()-this.utcOffset())*t,m=this-f,$=M.m(this,f);return $=(_={},_[l]=$/12,_[u]=$,_[h]=$/3,_[o]=(m-v)/6048e5,_[a]=(m-v)/864e5,_[i]=m/e,_[r]=m/t,_[n]=m/1e3,_)[p]||m,d?$:M.a($)},v.daysInMonth=function(){return this.endOf(u).$D},v.$locale=function(){return y[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var s=this.clone(),n=w(t,e,!0);return n&&(s.$L=n),s},v.clone=function(){return M.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},f}(),S=D.prototype;return b.prototype=S,[["$ms",s],["$s",n],["$m",r],["$H",i],["$W",a],["$M",u],["$y",l],["$D",c]].forEach((function(t){S[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),b.extend=function(t,e){return t.$i||(t(e,D,b),t.$i=!0),b},b.locale=w,b.isDayjs=g,b.unix=function(t){return b(1e3*t)},b.en=y[$],b.Ls=y,b.p={},b}()}},e={};function s(n){var r=e[n];if(void 0!==r)return r.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,s),i.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t="beforeend",e=(e,s,n="beforeend")=>{switch(s=s.getElement(),n){case"afterbegin":e.prepend(s);break;case t:e.append(s)}},n=t=>{null!==t&&(t.getElement().remove(),t.removeElement())};class r{constructor(){if(new.target===r)throw new Error("Can't instantiate Abstract, only cocrete one.");this._element=null,this._callbacks={}}getTemplate(){throw new Error("Abstarct nethod not implemented: getTemplate")}getElement(){return this._element||(this._element=(t=>{const e=document.createElement("div");return e.innerHTML=t,e.firstChild})(this.getTemplate())),this._element}removeElement(){this._element=null}}class i extends r{getTemplate(){return"<h2>\n      Ошибка загрузки данных с сервера. Попробуйте обновить страницу или зайти в позже\n    </h2>"}}class a extends r{constructor(t){super(),this._rate=t,this._rateChangeHadnler=this._rateChangeHadnler.bind(this)}getTemplate(){return`<li class="rate__item" data-tooltip="${(t=this._rate).Nominal>1?t.Nominal:""} ${t.Name}">\n      <div class="rate__name">${t.Nominal>1?t.Nominal:""} ${t.CharCode}</div>\n      <div class="current-day">${t.Value.toFixed(2)}</div>\n      <div class="rate__yesterday ${t.Value-t.Previous>0?"rate__yesterday--positive":"rate__yesterday--negative"}">${(t=>((t.Value-t.Previous)/t.Previous*100).toFixed(2)+"%")(t)}</div>\n    </li>`;var t}_rateChangeHadnler(t){t.preventDefault(),this._callbacks.previusRateHandler(t)}setLoadPreviusRatesHandler(t){this._callbacks.previusRateHandler=t,this.getElement().addEventListener("click",this._rateChangeHadnler)}}var o=s(484),u=s.n(o);class h extends r{constructor(t){super(),this._rates=t,this._popupCloseHandler=this._popupCloseHandler.bind(this)}getTemplate(){return`<div class="popup">\n      <div class="popup__wrapper">\n        <h2>${(t=this._rates)[0].CharCode}</h2>\n        <ul class="rate__list popup__list">\n          <li class="rate__item popup__item popup__item--first">\n            <div class="rate__name"><b>Дата</b></div>\n            <div class="rate__name"><b>Код валюты</b></div>\n            <div class="current-day"><b>Курс</b></div>\n          </li>\n          ${(t=>t.map((t=>`<li class="rate__item popup__item">\n        <div class="rate__name">${t.date?u()(t.date).format("DD/MM/YYYY"):"Сегодня"}</div>\n        <div class="rate__name">${t.Nominal>1?t.Nominal:""} ${t.CharCode}</div>\n        <div class="current-day">${t.Value.toFixed(2)}</div>\n      </li>`)))(t).join("\n")}\n        </ul>\n        <button class="popup__close-btn" type="button"></button>\n      </div>\n    </div>`;var t}_popupCloseHandler(t){this._callbacks.closeHandler(t)}setPopupCloseHandler(t){this._callbacks.closeHandler=t,this.getElement().addEventListener("click",this._popupCloseHandler)}}class l{constructor(t,e,s,n,r){this._container=t,this._body=e,this._rates=s,this._rate=n,this._escHandler=r,this._rateView=null,this._ratesPopupView=null,this._setRateHandler=this._setRateHandler.bind(this)}init(){this._rateView=new a(this._rate),e(this._container,this._rateView),this._setRateHandler()}_setRateHandler(){this._rateView.setLoadPreviusRatesHandler((()=>{this._createPopup()}))}_createPopup(){const t=this._rates.map((t=>t.filter((t=>t.ID===this._rate.ID)))).flat();this._ratesPopupView=new h(t),e(this._container,this._ratesPopupView),this._setPopupHandlers(),this._body.style.overflow="hidden"}_setPopupHandlers(){this._escHandler(),this._ratesPopupView.setPopupCloseHandler((t=>{(t.target.classList.contains("popup")||"BUTTON"===t.target.tagName)&&this.removePopup()}))}removePopup(){n(this._ratesPopupView),this._body.style.overflow="visible"}}const c=document.querySelector("body"),d=c.querySelector(".rate__list"),_=new class{constructor(t){this._url=t,this._previusRates=[]}async getRates(){try{const t=await fetch(this._url),e=await t.json();await this._getPreviusRates(e);const s=Object.values(e.Valute);return s.map((t=>t.date=e.Date)),this._previusRates.unshift(s),this._previusRates}catch{return[]}}async _getPreviusRates(t){let e=Object.assign({},t);for(let t=0;t<9;t++){const t=await fetch(e.PreviousURL);e=await t.json();const s=Object.values(e.Valute);s.map((t=>t.date=e.Date)),this._previusRates.push(s)}}}("https://www.cbr-xml-daily.ru/daily_json.js"),p=new class{constructor(){this._rates=[]}getRates(){return this._rates}setRates(t){this._rates=t}},f=new class extends r{constructor(){super()}getTemplate(){return"<li>\n      <h2>\n        Загружаем данные с сервера...\n      </h2>\n    </li>"}};e(d,f);const v=new class{constructor(t,e,s,n){this._container=t,this._ratesModel=s,this._body=e,this._loadingView=n,this._rateView=null,this._noRatesView=null,this._rates=[],this._ratesPresenters=[],this._setHandlerECS=this._setHandlerECS.bind(this),this._removePopupOnESC=this._removePopupOnESC.bind(this)}init(){if(n(this._loadingView),this._rates=this._ratesModel.getRates(),0===this._rates.length)return this._noRatesView=new i,void e(this._container,this._noRatesView);this._rates[0].forEach((t=>{this._renderRate(t)}))}_renderRate(t){const e=new l(this._container,this._body,this._rates,t,this._setHandlerECS);e.init(),this._ratesPresenters.push(e)}_setHandlerECS(){document.addEventListener("keydown",this._removePopupOnESC)}_removePopupOnESC(t){"Esc"!==t.key&&"Escape"!==t.key||(this._ratesPresenters.forEach((t=>t.removePopup())),document.removeEventListener("keydown",this._removePopupOnESC))}}(d,c,p,f);_.getRates().then((t=>{p.setRates(t),v.init()}))})()})();
//# sourceMappingURL=bundle.js.map